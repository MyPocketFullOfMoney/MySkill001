# 前言

该模块中主要记录工作中遇到与MySql有关的问题  

## 常用指令  

- 显示表结构  
    `desc [tablename]`  
- 查看建表语句  
    `show create table [tablename]`

## 常用函数

### concat

### sum

### date_format

### sysdate

### ifnull

### 开窗函数

## MySQL存储引擎

### InnoDB

### MyISAM

## 索引的原理

## 主键和外键

主键定义：表中经常有一列或多列的组合，其值能唯一的标识表中的每一行。

## 事务的基本概念

所谓**事务**是用户定义的一个数据库操作序列，这些操作要么全做，要么全不做，是一个不可分割的工作单位。

事务的特性：

- 原子性（Atomicity）
  >事务是数据库的逻辑工作单位，事务中包括的诸操作要么都做，要么都不做。
- 一致性（Consistency）
  >事务的执行结果必须是使数据库从一个一致性状态到另一个一致性状态。
- 隔离性（Isolation）
  >一个事务的执行不能被其他事务干扰。
- 持续性（Durability）
  >持续性也称永久性（Permanence）,指一个事务一旦提交，它对数据库中数据的改变就应该使永久的。

**事务是恢复和并发控制的基本单位。**

## 并发控制概述

上面提到**事务是并发控制的基本单位**，保证事务ACID特性是事务处理的重要任务，而事务的ACID特性可能遭到破坏的原因之一是多个事务对数据库的并发操作造成的。  

并发操作带来的数据不一致性包括**丢失修改、不可重复读和读“脏”数据**。  
产生上述数据不一致性的原因是因为并发操作破坏了事务的隔离性。

**并发控制的主要技术有封锁、时间戳、乐观控制法和多版本并发控制等。**

## 封锁

**封锁是实现并发控制的一个非常重要的技术。**  
基本的封锁类型有两种：排他锁（exclusive locks,简称X锁）和共享锁（share locks,简称S锁）。

**排他锁**又称为**写锁**。若事务T对数据对象A加上X锁，则只运行事务T读取和修改数据对象A，其他任何事务都不能再对A加任何类型的锁，直到T释放A上的锁为止。
>数据库中update操作对应的就是排他锁。

**共享锁**又称为**读锁**。若事务T对数据对象A加上S锁，则事务T可以读A但不能修改A，其他事务只能再对A加S锁，而不能加X锁，直到T释放A上的S锁为止。

### 封锁协议

在运用X锁和S锁这两种基本封锁对数据对象加锁时，还需要约定一些规则。  
例如，何时申请X锁或S、持锁时间、何时释放等。这些规则称为**封锁协议**。

- **一级封锁协议**
  >一级封锁协议是指，事务T在修改数据R之前必须先对其加X锁，直到事务结束才释放。  
  事务的结束包括正常结束（COMMIT）和非正常结束（ROLLBACK）。  
  **一级锁协议能防止丢失修改的问题。**

- **二级封锁协议**
  >二级封锁协议是指，在一级封锁协议基础上增加事务T在读取数据R之前必须先对其加S锁，**读完后即可释放S锁**。  
  **二级封锁协议除防止了丢失修改，还可进一步防止读“脏”数据**。  
  在二级封锁协议中，由于读完数据后即可释放S锁，**所以它不能保证可重复读**。

- **三级封锁协议**
  >三级封锁协议是指，在一级封锁协议的基础上增加事务T在读取数据R之前必须先对其加S锁，**直到事务结束才释放**。  
  **三级封锁协议除了防止丢失修改和读“脏”数据外，还进一步防止了不可重复读**。

**三级协议的主要区别在于什么操作需要申请封锁，以及何时释放锁（即持锁时间）**。
