# 目录
<!-- TOC -->

- [目录](#目录)
  - [操作系统](#操作系统)
    - [操作系统的目标](#操作系统的目标)
    - [操作系统的基本特性](#操作系统的基本特性)
  - [进程的基本概念](#进程的基本概念)
    - [进程的特征](#进程的特征)
    - [进程的状态](#进程的状态)
    - [进程同步](#进程同步)
  - [线程（Threads）的基本概念](#线程threads的基本概念)
    - [引入线程的目的](#引入线程的目的)
    - [线程如何提高并发](#线程如何提高并发)
    - [线程的状态](#线程的状态)
  - [协程的基本概念](#协程的基本概念)
    - [协程的优势](#协程的优势)
    - [进程、线程、协程应用场景](#进程线程协程应用场景)
  - [处理机调度和死锁](#处理机调度和死锁)
    - [处理机调度的层次](#处理机调度的层次)
    - [作业和作业调度](#作业和作业调度)
    - [作业调度算法](#作业调度算法)
      - [先来先服务（first-come first-served,FCFS）调度算法](#先来先服务first-come-first-servedfcfs调度算法)
      - [短作业优先（short job first,SJF）调度算法](#短作业优先short-job-firstsjf调度算法)
    - [进程调度](#进程调度)
      - [进程调度机制](#进程调度机制)
      - [进程调度方式](#进程调度方式)
      - [进程调度的算法](#进程调度的算法)
    - [死锁概述](#死锁概述)
      - [产生死锁的原因](#产生死锁的原因)
      - [死锁的定义](#死锁的定义)
      - [产生死锁的必要条件](#产生死锁的必要条件)
      - [处理死锁的方法](#处理死锁的方法)

<!-- /TOC -->

## 操作系统

操作系统是配置在计算机硬件上的第一层软件，是对硬件系统的首次扩充。

### 操作系统的目标

在计算机上配置操作系统，其主要目标是：方便性、有效性、可扩充性和开放性。

### 操作系统的基本特性

操作系统的四大基本特征：并发、共享、虚拟和异步。  

**并行和并发是两个相似又有区别的概念。**

并行性是指两个或多个事件在同一时刻发生。  
并发性是指两个或多个事件在同一时间间隔内发生。

为了提高系统的资源利用率，增加系统的吞吐量，引入了进程的概念。

## 进程的基本概念

进程是指在系统中独立运行并作为资源分配的基本单位，它是由一组机器指令、数据和堆栈等组成的，是一个能独立运行的活动实体。（好抽象QvQ）

进程并没有统一的定义。  
一般认为进程由程序、数据集合以及进程控制块`（Process Control Block，PCB）`组成。

- 程序用于描述进程要完成的功能，是控制进程执行的指令集;
- 数据集合是程序在执行时所需要的数据和工作区;
- 进程控制块，包含进程的描述信息和控制信息，是进程存在的唯一标志。

所以，程序和进程是两个截然不同的概念。

程序是指令和数据的有序集合，其本身没有任何运行的含义，是一个静态的概念。  
而进程是程序在处理机上的一次执行过程，它是一个动态的概念。

### 进程的特征

- 动态性
  >进程的实质是进程实体的执行过程。  
  进程的动态性表现在：“它由创建而产生，由调度而执行，由撤销而消亡。”
- 并发性
  >并发性是指多个进程实体同存于内存中，且能在一段时间内同时运行。
- 独立性
  >独立性是指进程实体是一个能独立运行、独立获得资源和独立接受调度的基本单位。
- 异步性
  >异步性是指进程是按异步方式运行的，即按各自独立的、不可预知的速度向前推进。
- 结构特征：进程由程序、数据和进程控制块`（PCB）`组成。

### 进程的状态

进程有三种基本状态：

- 就绪状态
  >这是指进程已处于准备好运行的状态，**即进程已分配到除CPU以外的所有必要资源后，只要再获得CPU，便可立即执行**。
- 执行状态
  >这是指进程已获得CPU，其程序正在执行的状态。
- 阻塞状态
  >这是指**正在执行**的进程由于发生某事件（如I/O请求、申请缓冲区失败等）暂时无法继续执行时的状态，亦即进程的执行受到阻塞。  
  此时引起进程调度，OS把处理机分配给另一个就绪进程，而让受阻进程处于暂停状态，一般将这种暂停状态成为阻塞状态，有时也称为等待状态或封锁状态。

进程在运行的过程中经常会发生状态的转换。

**进程三种状态转换关系：**

进程处于就绪态，在调度程序为之分配处理机之后便可执行，进程状态从就绪态转变为执行态。

进程处于执行态，当分配给进程的时间片用完之后，进程状态从执行态转变为就绪态。如果因发生某事件，致使当前进程的执行受阻（例如I/O请求），使之无法继续执行，则进程状态从执行态转换为阻塞态。

当进程处于阻塞状态，在I/O完成后，进程由阻塞态转换为就绪态。

![进程三种基本状态转换关系](https://note.youdao.com/yws/api/personal/file/WEB6db26d89947e4e77e526344e95371438?method=download&shareKey=b87febb8116e205662bed95d72dea134)

除了三种基本状态外，为了满足进程控制块对数据及操作的完整性要求以及增强管理的灵活性，通常在系统中又为进程引入了两种场景的状态：

- 创建状态
  >如果进程所需的资源尚不能得到满足，比如系统尚无足够内存加载进程，此时创建工作未完成，进程不能被调度运行，于是把此时进程所处的状态称为创建状态。
- 终止状态
  >当一个进程到达了自然结束点，或是出现了无法克服的错误，或是被操作系统所终结，或是被其他有终止权的进程所终结，它将进入终止状态。

### 进程同步

单处理机系统中的进程同步机制：

- 硬件同步机制
- 信号量机制
- 管程机制等
  >代表共享资源的数据结构以及由对该共享数据结构实施操作的一组过程所组成的资源管理程序共同构成了一个操作系统的资源管理模块，我们称之为**管程**。

进程同步机制的主要任务是对多个相关进程在执行次序上进行协调，使并发执行的诸进程之间能按照一定的规则（或时序）共享系统资源，并能很好地相互合作，从而使程序地执行具有可在现性。

同步机制应遵循地规则：

- 空闲让进
- 忙则等待
- 有限等待
- 让权等待

进程同步的经典问题：“生产者——消费者”问题、“读者——写者问题”、“哲学家进餐问题”等。

## 线程（Threads）的基本概念

### 引入线程的目的

在OS中引入进程的目的使为了使多个程序能并发执行，以提高资源利用率和系统吞吐量。那么，在操作系统中再引入线程，则是**为了减少程序在并发执行时所付出的时空开销**，使OS具有更好的并发性。

创建进程、撤销进程、切换进程，系统必须为之付出较大的时空开销。

### 线程如何提高并发

进程具有两个基本属性：

- 进程是一个可拥有资源的独立单位
- 进程是一个可独立调度和分派的基本单位

为了使多个程序更好的并发执行，同时又尽量减少系统的开销，研究操作系统的学者们就设法将进程的两个基本属性分开，由OS分开处理，即不把调度和分派的基本单位也同时作为拥有资源的单位，以做到“轻装上阵”;而对于拥有资源的基本单位，又不对之施加频繁的切换。在这种思想指导下，形成了线程的概念。

**在操作系统中引入线程后，线程作为调度和分派的基本单位**。当线程切换时，仅需保存和设置少量寄存器内容，切换代价远低于进程。而且在同一进程中，线程的切换不会引起进程的切换，但从一个进程的线程切换到另一个进程的线程，必然会引起进程的切换。

线程具有许多传统进程所具有的特征，所以又称之为轻型进程。

同一个进程的多个线程可以并发执行。

线程本身仅拥有一点必不可少的、能保证独立运行的资源。例如用于控制线程运行的线程控制块TCB、用于指示被执行指令的程序计数器、保留局部变量、少数状态参数和返回地址等的一组寄存器和堆栈。  
但允许多个线程共享该进程所拥有的资源。

### 线程的状态

线程和进程一样拥有三种基本状态：就绪态、执行态、阻塞态。  
他们的转换关系和进程状态之间的转换是一样的。

## 协程的基本概念

**协程(Coroutines),是一种比线程更轻量级的存在**。一个进程可以拥有多个线程，一个线程可以拥有多个协程。但某一时刻只能有一个协程运行，多个协程分享该线程分配到的计算机资源。

### 协程的优势

- 无需线程的上下文切换
- 无需原子操作锁定及同步的开销
- 方便切换控制流，简化编程模型

### 进程、线程、协程应用场景

- 线程和协程推荐在I/O密集型的任务中使用，而在CPU密集型的任务中，表现较差。
- 对于CPU密集型任务，则需要多个进程，利用所有可用的CPU核心，提高执行效率。
- 所以大并发下的最佳实践就是多进程+多协程，既充分利用多核，又充分发挥协程的高效率，可获得极高的性能。

## 处理机调度和死锁

### 处理机调度的层次

- **高级调度**
  >高级调度又称为长程调度或**作业调度**，它的调度对象是作业。其主要功能是根据某种算法，**决定将外存上处于后备队列中的哪几个作业调入内存，为它们创建进程、分配必要的资源，并将他们放入就绪队列。高级调度主要用于多道批处理系统，而在分时和实时系统中不设置高级调度。**
- **低级调度**
  >低级调度又称为**进程调度**或短程调度，其所调度的对象是**进程（或内核级线程）**。其主要功能是根据某种算法，决定就绪队列中的哪个进程应获得处理机，并由分派程序将处理机分配给被选中的进程。进程调度是最基本的一种调度，在多道批处理、分时和实时三种类型的OS中，都必须配置。
- **中级调度**
  >中级调度又称为**内存调度**。引入中级调度的主要目的是，提高内存利用率和系统吞吐量。

### 作业和作业调度

**作业是一个比程序更广泛的概念，它不仅包含了通常的程序和数据，而且还应配有一份作业说明书，系统根据该说明书对程序的运行进行控制。在批处理系统中，是以作业为基本单位从外存调入内存。**

### 作业调度算法

#### 先来先服务（first-come first-served,FCFS）调度算法

#### 短作业优先（short job first,SJF）调度算法

### 进程调度

#### 进程调度机制

#### 进程调度方式

- **非抢占方式**

- **抢占方式**

抢占方式遵循的原则

#### 进程调度的算法

- 轮转（RR）调度算法
- 优先级调度算法
- 多队列调度算法
- 多级反馈队列调度算法
- 基于公平原则的调度算法

### 死锁概述

#### 产生死锁的原因

- 多个进程对资源的争夺，进程对不可抢占资源和可消耗资源，都会产生死锁。
- 进程推进顺序不当

#### 死锁的定义

**如果一组进程中的每一个进程都在等待仅由该组进程中的其它进程才能引发的事件，那么该组进程是死锁的（Deadlock）**。

#### 产生死锁的必要条件

- 互斥条件
- 请求和保持条件
- 不可抢占条件
- 循环等待条件

#### 处理死锁的方法

- 预防死锁
- 避免死锁  
  银行家算法
- 检测死锁
- 解除死锁
